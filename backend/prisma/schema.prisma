generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id             String          @id @default(cuid())
  email          String          @unique
  password       String
  role           UserRole        @default(CLIENT)
  firstName      String
  lastName       String
  company        String?
  phone          String?
  address        String?
  postalCode     String?
  city           String?
  country        String          @default("Ã–sterreich")
  profileImage   String?
  vatNumber      String?
  homepage       String?
  isActive       Boolean         @default(true)
  emailVerified  Boolean         @default(false)
  lastLogin      DateTime?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  auditLogs      AuditLog[]
  client         Client?
  domains        Domain[]
  emailAccounts  EmailAccount[]
  hostingPlans   HostingPlan[]
  invoices       Invoice[]
  quotes         Quote[]
  sessions       Session[]
  wordPressSites WordPressSite[]

  @@map("users")
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique @db.VarChar(768)
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "sessions_userId_fkey")
  @@map("sessions")
}

model Client {
  id           String     @id @default(cuid())
  clientNumber Int        @unique
  type         ClientType @default(COMPANY)
  name         String
  vatNumber    String?
  address      String?
  countryCode  String     @default("AT")
  phone        String?
  email        String?
  homepage     String?
  fixedNote    String?    @db.Text
  userId       String?    @unique
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  user         User?      @relation(fields: [userId], references: [id])
  invoices     Invoice[]
  quotes       Quote[]

  @@map("clients")
}

model Quote {
  id                   String      @id @default(cuid())
  quoteNumber          String      @unique
  userId               String
  clientId             String?
  issueDate            DateTime    @default(now())
  validUntil           DateTime
  status               QuoteStatus @default(DRAFT)
  servicePeriodStart   DateTime?
  servicePeriodEnd     DateTime?
  subtotal             Decimal     @db.Decimal(10, 2)
  taxRate              Decimal     @default(20.00) @db.Decimal(5, 2)
  taxAmount            Decimal     @db.Decimal(10, 2)
  total                Decimal     @db.Decimal(10, 2)
  isReverseCharge      Boolean     @default(false)
  pdfUrl               String?
  notes                String?     @db.Text
  reverseChargeNote    String?
  convertedToInvoiceId String?
  convertedAt          DateTime?
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  globalDiscount       Decimal?    @default(0.00) @db.Decimal(5, 2)
  items                QuoteItem[]
  client               Client?     @relation(fields: [clientId], references: [id])
  user                 User        @relation(fields: [userId], references: [id])

  @@index([clientId], map: "quotes_clientId_fkey")
  @@index([userId], map: "quotes_userId_fkey")
  @@map("quotes")
}

model QuoteItem {
  id          String   @id @default(cuid())
  quoteId     String
  productName String?
  description String
  quantity    Decimal  @default(1.000) @db.Decimal(10, 3)
  unitName    String?
  unitPrice   Decimal  @db.Decimal(10, 2)
  taxRate     Decimal? @db.Decimal(5, 2)
  total       Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  discount    Decimal? @default(0.00) @db.Decimal(5, 2)
  quote       Quote    @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId], map: "quote_items_quoteId_fkey")
  @@map("quote_items")
}

model Invoice {
  id                 String        @id @default(cuid())
  invoiceNumber      String        @unique
  userId             String
  clientId           String?
  issueDate          DateTime      @default(now())
  dueDate            DateTime
  status             InvoiceStatus @default(DRAFT)
  servicePeriodStart DateTime?
  servicePeriodEnd   DateTime?
  subtotal           Decimal       @db.Decimal(10, 2)
  taxRate            Decimal       @default(20.00) @db.Decimal(5, 2)
  taxAmount          Decimal       @db.Decimal(10, 2)
  total              Decimal       @db.Decimal(10, 2)
  isReverseCharge    Boolean       @default(false)
  paidAt             DateTime?
  paidAmount         Decimal?      @db.Decimal(10, 2)
  pdfUrl             String?
  notes              String?       @db.Text
  reverseChargeNote  String?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  globalDiscount     Decimal?      @default(0.00) @db.Decimal(5, 2)
  items              InvoiceItem[]
  client             Client?       @relation(fields: [clientId], references: [id])
  user               User          @relation(fields: [userId], references: [id])

  @@index([clientId], map: "invoices_clientId_fkey")
  @@index([userId], map: "invoices_userId_fkey")
  @@map("invoices")
}

model InvoiceItem {
  id          String   @id @default(cuid())
  invoiceId   String
  productName String?
  description String
  quantity    Decimal  @default(1.000) @db.Decimal(10, 3)
  unitName    String?
  unitPrice   Decimal  @db.Decimal(10, 2)
  taxRate     Decimal? @db.Decimal(5, 2)
  total       Decimal  @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  discount    Decimal? @default(0.00) @db.Decimal(5, 2)
  invoice     Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)

  @@index([invoiceId], map: "invoice_items_invoiceId_fkey")
  @@map("invoice_items")
}

model WordPressSite {
  id               String              @id @default(cuid())
  userId           String
  domain           String              @unique
  siteUrl          String
  adminUrl         String
  status           WordPressSiteStatus @default(ACTIVE)
  phpVersion       String              @default("8.3")
  wordPressVersion String?
  storageUsed      Int                 @default(0)
  storageLimit     Int                 @default(5000)
  databaseName     String
  databaseUser     String
  serverIp         String?
  sslEnabled       Boolean             @default(false)
  sslExpiresAt     DateTime?
  lastBackup       DateTime?
  backupEnabled    Boolean             @default(true)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  user             User                @relation(fields: [userId], references: [id])

  @@index([userId], map: "wordpress_sites_userId_fkey")
  @@map("wordpress_sites")
}

model HostingPlan {
  id                String            @id @default(cuid())
  userId            String
  name              String
  type              HostingPlanType
  status            HostingPlanStatus @default(ACTIVE)
  storageLimit      Int
  bandwidthLimit    Int
  databaseLimit     Int               @default(10)
  emailAccountLimit Int               @default(50)
  domainLimit       Int               @default(5)
  storageUsed       Int               @default(0)
  bandwidthUsed     Int               @default(0)
  monthlyPrice      Decimal           @db.Decimal(10, 2)
  billingCycle      Int               @default(1)
  startDate         DateTime          @default(now())
  renewalDate       DateTime
  expiresAt         DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  user              User              @relation(fields: [userId], references: [id])

  @@index([userId], map: "hosting_plans_userId_fkey")
  @@map("hosting_plans")
}

model Domain {
  id              String       @id @default(cuid())
  userId          String
  domainName      String       @unique
  status          DomainStatus @default(ACTIVE)
  registrar       String       @default("Hetzner")
  registeredAt    DateTime
  expiresAt       DateTime
  autoRenew       Boolean      @default(true)
  nameservers     String       @db.Text
  whoisProtection Boolean      @default(false)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  dnsRecords      DnsRecord[]
  user            User         @relation(fields: [userId], references: [id])

  @@index([userId], map: "domains_userId_fkey")
  @@map("domains")
}

model DnsRecord {
  id        String        @id @default(cuid())
  domainId  String
  type      DnsRecordType
  name      String
  value     String
  ttl       Int           @default(3600)
  priority  Int?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  domain    Domain        @relation(fields: [domainId], references: [id], onDelete: Cascade)

  @@index([domainId], map: "dns_records_domainId_fkey")
  @@map("dns_records")
}

model EmailAccount {
  id               String             @id @default(cuid())
  userId           String
  email            String             @unique
  password         String
  status           EmailAccountStatus @default(ACTIVE)
  quotaLimit       Int                @default(5000)
  quotaUsed        Int                @default(0)
  forwardTo        String?
  autoresponder    Boolean            @default(false)
  autoresponderMsg String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  user             User               @relation(fields: [userId], references: [id])

  @@index([userId], map: "email_accounts_userId_fkey")
  @@map("email_accounts")
}

model AuditLog {
  id         String      @id @default(cuid())
  userId     String
  action     AuditAction
  targetId   String?
  targetType String?
  details    Json?
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime    @default(now())
  user       User        @relation(fields: [userId], references: [id])

  @@index([userId], map: "audit_logs_userId_fkey")
  @@map("audit_logs")
}

enum UserRole {
  ADMIN
  CLIENT
}

enum ClientType {
  COMPANY
  PRIVATE
}

enum QuoteStatus {
  DRAFT
  SENT
  ACCEPTED
  DECLINED
  CONVERTED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
  CANCELLED
}

enum WordPressSiteStatus {
  ACTIVE
  SUSPENDED
  MAINTENANCE
  DELETED
}

enum HostingPlanType {
  BASIC
  STANDARD
  PREMIUM
  ENTERPRISE
}

enum HostingPlanStatus {
  ACTIVE
  SUSPENDED
  CANCELLED
  EXPIRED
}

enum DomainStatus {
  ACTIVE
  PENDING_TRANSFER
  EXPIRED
  SUSPENDED
  CANCELLED
}

enum DnsRecordType {
  A
  AAAA
  CNAME
  MX
  TXT
  SRV
  NS
}

enum EmailAccountStatus {
  ACTIVE
  SUSPENDED
  DELETED
}

enum AuditAction {
  LOGIN
  LOGOUT
  LOGIN_AS_CLIENT
  FAILED_LOGIN_AS_CLIENT_ATTEMPT
  CREATE_INVOICE
  DELETE_INVOICE
  CREATE_QUOTE
  DELETE_QUOTE
  CONVERT_QUOTE_TO_INVOICE
  CREATE_WORDPRESS_SITE
  DELETE_WORDPRESS_SITE
  UPDATE_USER
  UPDATE
  DELETE_USER
  CREATE_DOMAIN
  DELETE_DOMAIN
  CREATE_EMAIL
  DELETE_EMAIL
  UPDATE_HOSTING_PLAN
}
